<!DOCTYPE html>
<html>
    
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

        <script>
          (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-7693502789508846",
            enable_page_level_ads: true
          });
        </script>

    </head>
    
    <body ng-app="myApp" ng-controller="Controller">
        <div class="navbar navbar-default navbar-fixed-top">
            <div class="container-fluid">
                <div class="navbar-header" style="height:45px;">
                    <a class="navbar-brand" href="/"><i class="fa fa-home"></i></a>
                    <form role="form" id="formNavbar">
                        <div class="form-group">
                            <input type="text" id="pac-input" placeholder="Cerca cittÃ ">
                        </div>
                    </form>
                    <a type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></a>
                </div>
                <div>
                    <a class="btn btn-block btn-info navbar-btn" data-toggle="modal" data-target="#sendContact"
                    contenteditable="true">Vuoi essere contattato ?</a>
                </div>
                <div class="collapse navbar-collapse navbar-ex1-collapse">
                    <ul class="nav navbar-nav navbar-right">
                        <!-- content added by common.js -->
                    </ul>
                </div>
            </div>
        </div>
        <div class="section">
            <div class="container">
                <div class="row">
                    <div class="col-md-12 colRisultati">
                        <img ng-show="loading" width="50" style="margin-top:100px;" src="img/loading.gif"
                        class="center-block">
                        <ul class="media-list">
                            <li class="media" style="background-color:rgb(229, 242, 245);height:70px;"
                            ng-repeat="item in items">
                                <a class="pull-right" href="/card.html?cardUrl={{item.url}}">
                  <img class="media-object" ng-src="http://www.lacasadiriposo.it{{item.img}}" style="max-width:95px;max-height:70px; "></a>
                                <div class="media-body">
                                    <a href="/card.html?cardUrl={{item.url}}">
                    <p class="media-heading" style="color:#033e4a;">{{ item.nomeStruttura }}</p></a>
                                    <p style="color:#10687a;">{{ item.comune }} ( {{ item.provincia }} ) - {{item.indirizzo}}.</p>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <script>
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
                
                        ga('create', 'UA-58415575-1', 'auto');
                        ga('send', 'pageview');
            </script>
        </div>
        <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
        <script type="text/javascript" src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.9/jquery.validate.js"></script>
        <script type="text/javascript" src="localization/messages_it.js">
</script>
        <script type="text/javascript" src="http://netdna.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
        <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&amp;libraries=places"></script>
        <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.3.5/angular.min.js"></script>
        <script src="common.js"></script>
        <script>
            var HOST = "http://www.lacasadiriposo.it/api/strutture.php?path=";
            var myApp = angular.module('myApp', []);
            myApp.controller('Controller', function($scope, $location) {

                $("form").on("submit", function(event) {
                  event.preventDefault();        
                });

                $scope.initializeInputGooglePlace = function(){
                    var input = document.getElementById('pac-input');
                    var options = {
                        types: ['(regions)'],
                        componentRestrictions: {
                            country: 'it'
                        }
                    };
                    var autocomplete = new google.maps.places.Autocomplete(input, options);
                    
                    google.maps.event.addListener(autocomplete, 'place_changed', function(val) {
                        // fake submit afer complete occurs
                        var place = autocomplete.getPlace();


                        if(place.address_components){
                            if(place.address_components.length == 4){
                                var string = place.address_components[0].long_name+","+place.address_components[1].short_name;
                            }else
                                var string = place.address_components[0].long_name+","+place.address_components[2].short_name;
                            $scope.load(string+",Italia");
                        }else{
                            // direct enter
                            var firstResult = $(".pac-container .pac-item:first").text();
                            var arr = firstResult.split(',');
                            var string = arr[0];
                            var firstPart = string.substr(0,string.length - 2);
                            var lastPart = string.substr(string.length - 2);
                            $(input).val(firstPart+","+lastPart+",Italia");
                            $(input).blur();
                            $scope.load(firstPart+","+lastPart+",Italia");
                        }
                    }); 
                };
                
                $scope.load = function(path) {
                    $scope.$apply(function() {
                        $scope.items = [];
                        $scope.loading = true;
                    });

                    if(path){
                        var url = path.replace(/\s/g, '');
                        $.getJSON(HOST + path.replace(/\s/g, '') , function(data) {
                            $scope.$apply(function() {
                                $scope.loading = false;
                                $scope.items = data;
                            });
                        });
                    }else
                        console.log(path);
                }
                $scope.initializeInputGooglePlace();


                var callback = function(response){
                    var url = "";
                    if(response && response.city)
                        url = response.city;
                    else
                        url = "Milano,MI,Italia";
                    $scope.load(url);
                }

                if(getUrlParameter('path')){
                    $scope.load(getUrlParameter('path'));
                }else{
                    $.get("http://ipinfo.io")
                     .success(function(result) { callback(result); })
                     .error(function(jqXHR, textStatus, errorThrown) {  callback(false); });
                }
            });
        </script>
        <link href="theme.css" rel="stylesheet" type="text/css">
        <link href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css"
        rel="stylesheet" type="text/css">
    </body>

</html>